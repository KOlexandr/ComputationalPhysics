<html>
<head>
    <title>Hodgkin-Huxley Model Simulation in Javascript</title>
    <meta name="description" content="Interactive Javascript Simulation of the Hodgkin-Huxley Model for Action Potential Generation in the Squid Giant Axon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
</head>
<body style="padding: 5px;" cz-shortcut-listen="true">
<nav class="navbar navbar-default" role="navigation">
    <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/index.html">myselph.de</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav">
            <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Rigid Body Game Physics <b class="caret"></b></a>
                <ul class="dropdown-menu">
                    <li><a href="/gamePhysics/index.html">Overview</a></li>
                    <li class="divider"></li>
                    <li><a href="/gamePhysics/unconstrained.html">Unconstrained Motion</a></li>
                    <li><a href="/gamePhysics/equalityConstraints.html">Equality Constraints</a></li>
                    <li><a href="/gamePhysics/inequalityConstraints.html">Inequality Constraints</a></li>
                    <li><a href="/gamePhysics/friction.html">Friction</a></li>
                    <li><a href="/gamePhysics/collisionDetection.html">Collision Detection</a></li>
                    <li class="divider"></li>
                    <li><a href="/gamePhysics/links.html">Links</a></li>
                </ul>
            </li>
            <li>
                <a href="/hodgkinHuxley.html">Hodgkin-Huxley</a>
            </li>
            <li>
                <a href="/neuralNet.html">Neural Net for MNIST</a>
            </li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
            <li><a href="/aboutMe.html">About me</a></li>
        </ul>
    </div>
</nav>
<script type="text/javascript">
    $.get('/navbar.html', function (data) {
        $("nav.navbar").html(data);
    });
</script>
<div class="container bs-docs-container">
    <div id="dbgOutput">
    </div>
    <h1>Hodgkin-Huxley Simulation with Javascript</h1>

    <div class="container">
        <div id="hodgkinHuxley" style="width: 640px; height: 480px; float: left; padding: 0px; position: relative;"
             class="demo-placeholder">
            <canvas class="flot-base" width="640" height="480"
                    style="direction: ltr; position: absolute; left: 0px; top: 0px; width: 640px; height: 480px;"></canvas>
            <div class="flot-text"
                 style="position: absolute; top: 0px; left: 0px; bottom: 0px; right: 0px; font-size: smaller; color: rgb(84, 84, 84);">
                <div class="flot-x-axis flot-x1-axis xAxis x1Axis"
                     style="position: absolute; top: 0px; left: 0px; bottom: 0px; right: 0px; display: block;">
                    <div class="flot-tick-label tickLabel"
                         style="position: absolute; max-width: 71px; top: 461px; left: 22px; text-align: center;">0
                    </div>
                    <div class="flot-tick-label tickLabel"
                         style="position: absolute; max-width: 71px; top: 461px; left: 95px; text-align: center;">25
                    </div>
                    <div class="flot-tick-label tickLabel"
                         style="position: absolute; max-width: 71px; top: 461px; left: 171px; text-align: center;">50
                    </div>
                    <div class="flot-tick-label tickLabel"
                         style="position: absolute; max-width: 71px; top: 461px; left: 246px; text-align: center;">75
                    </div>
                    <div class="flot-tick-label tickLabel"
                         style="position: absolute; max-width: 71px; top: 461px; left: 319px; text-align: center;">100
                    </div>
                    <div class="flot-tick-label tickLabel"
                         style="position: absolute; max-width: 71px; top: 461px; left: 395px; text-align: center;">125
                    </div>
                    <div class="flot-tick-label tickLabel"
                         style="position: absolute; max-width: 71px; top: 461px; left: 470px; text-align: center;">150
                    </div>
                    <div class="flot-tick-label tickLabel"
                         style="position: absolute; max-width: 71px; top: 461px; left: 546px; text-align: center;">175
                    </div>
                    <div class="flot-tick-label tickLabel"
                         style="position: absolute; max-width: 71px; top: 461px; left: 622px; text-align: center;">200
                    </div>
                </div>
                <div class="flot-y-axis flot-y1-axis yAxis y1Axis"
                     style="position: absolute; top: 0px; left: 0px; bottom: 0px; right: 0px; display: block;">
                    <div class="flot-tick-label tickLabel"
                         style="position: absolute; top: 336px; left: 14px; text-align: right;">0
                    </div>
                    <div class="flot-tick-label tickLabel"
                         style="position: absolute; top: 224px; left: 8px; text-align: right;">50
                    </div>
                    <div class="flot-tick-label tickLabel"
                         style="position: absolute; top: 112px; left: 2px; text-align: right;">100
                    </div>
                    <div class="flot-tick-label tickLabel"
                         style="position: absolute; top: 1px; left: 2px; text-align: right;">150
                    </div>
                    <div class="flot-tick-label tickLabel"
                         style="position: absolute; top: 448px; left: 4px; text-align: right;">-50
                    </div>
                </div>
            </div>
            <canvas class="flot-overlay" width="640" height="480"
                    style="direction: ltr; position: absolute; left: 0px; top: 0px; width: 640px; height: 480px;"></canvas>
            <div class="legend">
                <div style="position: absolute; width: 150px; height: 38px; top: 14px; right: 14px; opacity: 0.85; background-color: rgb(255, 255, 255);"></div>
                <table style="position:absolute;top:14px;right:14px;;font-size:smaller;color:#545454">
                    <tbody>
                    <tr>
                        <td class="legendColorBox">
                            <div style="border:1px solid #ccc;padding:1px">
                                <div style="width:4px;height:0;border:5px solid rgb(0,0,0);overflow:hidden"></div>
                            </div>
                        </td>
                        <td class="legendLabel">membrane voltage (mV)</td>
                    </tr>
                    <tr>
                        <td class="legendColorBox">
                            <div style="border:1px solid #ccc;padding:1px">
                                <div style="width:4px;height:0;border:5px solid rgb(255,0,0);overflow:hidden"></div>
                            </div>
                        </td>
                        <td class="legendLabel">injected current (nA/cm^2)</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div style="float:left;">
            <table>
                <tbody>
                <tr>
                    <td>C (muF/cm^2):</td>
                    <td><input type="number" name="C" min="0.001" max="100" value="1"></td>
                </tr>
                <tr>
                    <td>GKMax (mS/cm^2):</td>
                    <td><input type="number" name="GKMax" min="0" max="500" value="36"></td>
                </tr>
                <tr>
                    <td>GNaMax (mS/cm^2):</td>
                    <td><input type="number" name="GNaMax" min="0" max="500" value="120"></td>
                </tr>
                <tr>
                    <td>Gm (mS/cm^2):</td>
                    <td><input type="number" name="Gm" min="0" max="10" value="0.3"></td>
                </tr>
                <tr>
                    <td>EK (mV):</td>
                    <td><input type="number" name="EK" min="-200" max="200" value="-12"></td>
                </tr>
                <tr>
                    <td>ENa (mV):</td>
                    <td><input type="number" name="ENa" min="-200" max="200" value="115"></td>
                </tr>
                <tr>
                    <td>VRest (mV):</td>
                    <td><input type="number" name="VRest" min="-200" max="200" value="10.613"></td>
                </tr>
                <tr>
                    <td>V(0) (mV):</td>
                    <td><input type="number" name="V0" min="-200" max="200" value="0"></td>
                </tr>
                <tr>
                    <td>tStop (ms):</td>
                    <td><input type="number" name="tStop" min="0" max="2000" value="200"></td>
                </tr>
                <tr>
                    <td>tInjStart (ms):</td>
                    <td><input type="number" name="tInjStart" min="0" max="2000" value="25"></td>
                </tr>
                <tr>
                    <td>tInjStop (ms):</td>
                    <td><input type="number" name="tInjStop" min="0" max="2000" value="175"></td>
                </tr>
                <tr>
                    <td>IDC (nA/cm^2):</td>
                    <td><input type="number" name="IDC" min="0" max="200" value="0"></td>
                </tr>
                <tr>
                    <td>IRand (nA/cm^2):</td>
                    <td><input type="number" name="IRand" min="0" max="200" value="35"></td>
                </tr>
                <tr>
                    <td>Itau (ms):</td>
                    <td><input type="number" name="Itau" min="0" max="10" value="1"></td>
                </tr>
                </tbody>
            </table>
            <button name="startStopButton">Start</button>
            <p id="time">t=0s</p>
        </div>
    </div>
    <script type="text/javascript" src="js/flot/jquery.flot.js"></script>

    <script type="text/javascript">
        HH = function (C, GKMax, GNaMax, Gm, EK, ENa, VRest, V0) {
            this.dt = 0.025; //ms
            this.C = C; //in muF/cm^2
            this.GKMax = GKMax;
            this.GNaMax = GNaMax;
            this.EK = EK; //mV
            this.ENa = ENa;
            this.Gm = Gm;
            this.VRest = VRest;
            this.V = V0;
            this.n = 0.32;
            this.m = 0.05;
            this.h = 0.60;
            this.INa = 0;
            this.IK = 0;
            this.Im = 0;
            this.Iinj = 0;

            function alphaN(V) {
                if (V === 10) return alphaN(V + 0.001); // 0/0 -> NaN
                return (10 - V) / (100 * (Math.exp((10 - V) / 10) - 1));
            };
            function betaN(V) {
                return 0.125 * Math.exp(-V / 80);
            };

            function alphaM(V) {
                if (V === 25) return alphaM(V + 0.001);  // 0/0 -> NaN
                return (25 - V) / (10 * (Math.exp((25 - V) / 10) - 1));
            };
            function betaM(V) {
                return 4 * Math.exp(-V / 18)
            };

            function alphaH(V) {
                return 0.07 * Math.exp(-V / 20);
            };
            function betaH(V) {
                return 1 / (Math.exp((30 - V) / 10) + 1);
            };

            this.step = function () {
                var aN = alphaN(this.V);
                var bN = betaN(this.V);
                var aM = alphaM(this.V);
                var bM = betaM(this.V);
                var aH = alphaH(this.V);
                var bH = betaH(this.V);

                var tauN = 1 / (aN + bN);
                var tauM = 1 / (aM + bM);
                var tauH = 1 / (aH + bH);
                var nInf = aN * tauN;
                var mInf = aM * tauM;
                var hInf = aH * tauH;

                this.n += this.dt / tauN * (nInf - this.n);
                this.m += this.dt / tauM * (mInf - this.m);
                this.h += this.dt / tauH * (hInf - this.h);
                this.INa = this.GNaMax * this.m * this.m * this.m * this.h * (this.ENa - this.V);
                this.IK = this.GKMax * this.n * this.n * this.n * this.n * (this.EK - this.V);
                this.Im = this.Gm * (this.VRest - this.V);

                this.V += this.dt / this.C * (this.INa + this.IK + this.Im + this.Iinj);
            };
        };
    </script>
    <script type="text/javascript">
        $(function () {
            var plot = $.plot("#hodgkinHuxley", [[]],
                    {
                        xaxis: {min: 0, max: 200},
                        yaxis: {min: -50, max: 150},
                        colors: ['#000000', '#FF0000']
                    });
            var simulationRunning = false;
            $("[name=startStopButton]").click(function () {
                /* Parameters */
                var C = parseFloat($("input[name=C]").val());
                var GKMax = parseFloat($("input[name=GKMax]").val());
                var GNaMax = parseFloat($("input[name=GNaMax]").val());
                var Gm = parseFloat($("input[name=Gm]").val());
                var EK = parseFloat($("input[name=EK]").val());
                var ENa = parseFloat($("input[name=ENa]").val());
                var VRest = parseFloat($("input[name=VRest]").val());
                var V0 = parseFloat($("input[name=V0]").val());
                var tStop = parseFloat($("input[name=tStop]").val());
                var tInjStart = parseFloat($("input[name=tInjStart]").val());
                var tInjStop = parseFloat($("input[name=tInjStop]").val());
                var IDC = parseFloat($("input[name=IDC]").val());
                var IRand = parseFloat($("input[name=IRand]").val());
                var Itau = parseFloat($("input[name=Itau]").val());

                var plot = $.plot("#hodgkinHuxley", [{data: [[]], label: "membrane voltage (mV)"},
                            {data: [[]], label: "injected current (nA/cm^2)"}],
                        {
                            xaxis: {min: 0, max: tStop},
                            yaxis: {min: -50, max: 150},
                            colors: ['#000000', '#FF0000']
                        });

                var hodgkinHuxley = new HH(C, GKMax, GNaMax, Gm, EK, ENa, VRest, V0);

                var Vs = new Array(Math.floor(tStop / hodgkinHuxley.dt));
                var Iinj = new Array(Math.floor(tStop / hodgkinHuxley.dt));
                // sample rate of simulation data to generate plotting data
                var plotSampleRate = Math.ceil(tStop / 2000 / hodgkinHuxley.dt);
                var i = 0;
                for (var t = 0; t < tStop; t += hodgkinHuxley.dt) {
                    if (t > tInjStart && t < tInjStop) {
                        rawInj = IDC + IRand * 2 * (Math.random() - 0.5);
                    } else {
                        rawInj = 0;
                    }
                    hodgkinHuxley.Iinj += hodgkinHuxley.dt / Itau * (rawInj - hodgkinHuxley.Iinj);
                    hodgkinHuxley.step();
                    if (i == plotSampleRate) {
                        Vs.push([t, hodgkinHuxley.V]);
                        Iinj.push([t, hodgkinHuxley.Iinj]);
                        i = 0;
                    }
                    i++;
                }
                if (isNaN(Vs[Vs.length - 1][1])) {
                    $('#errorDiv').html('<b>simulation produced NaN, probably numerical instability or bug</b>');
                } else {
                    $('#errorDiv').html();
                }
                plot.setData([Vs, Iinj]);
                plot.draw();
            });
        });
    </script>
    <div id="errorDiv" style="color:#FF0000;"></div>
    <div>
        A simple browser/Javascript based simulation of
        <a href="http://en.wikipedia.org/wiki/Hodgkin%E2%80%93Huxley_model">Hodgkin's &amp; Huxley's formulas</a>
        for action potential generation in the squid giant axon. I suppose the source code is mostly self-explaining.
        I use the parameters from Christof Koch's book Biophysics of Computation, chapter 6,
        the formulas for forward and backward rates, and the differential equations for the
        three gating variables. For both these equations and the transmembrane current equation,
        I use explicit (forward) Euler for discretization and a time step of 0.025ms.
        The current consists of a DC (IDC) and a random component (uniform distribution (-1; 1),
        scaled by IRand), lowpass-filtered (1st order RC) with Itau.<br>
        Please drop me an email if there's anything wrong or unclear.
    </div>
    <div>
    </div>
</div>
<footer style="margin-top:100px;border-top:1px solid #e0e0e0;padding:40px;" role="contentinfo">
    <div class="container">
        Written by Hubert Eichner (hubert@THISDOMAIN), 2014.
        Code licensed under the <a href="http://opensource.org/licenses/MIT">MIT license</a>
    </div>
</footer>
<script type="text/javascript">
    $.get('/footer.html', function (data) {
        $("footer").html(data);
    });
</script>


</body>
</html>